<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>{{TITLE}}</title>
<style>
  :root{
    --bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#9aa4b2; --ring:#1f2937;
    --pill:#111827; --shadow:0 1px 2px rgba(0,0,0,.5),0 6px 18px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
       font:500 16px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter}

  /* ===== Sticky header (fixed layout) ===== */
  .topbar{
    position:fixed; top:0; left:0; right:0;
    background:var(--bg); border-bottom:1px solid var(--ring);
    display:flex; flex-direction:column; gap:6px;
    padding:10px 16px; z-index:50; backdrop-filter:blur(8px);
  }
  .brand{font-weight:800; font-size:20px}
  .updated{font-size:13px; color:var(--muted)}
  .toolbar{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
  .input,.select,.toggle{
    background:var(--card); color:var(--text);
    border:1px solid var(--ring); border-radius:10px; padding:10px 12px
  }
  .input{flex:1 1 260px; min-width:220px}
  .select{flex:0 0 180px}
  .toggle{flex:0 0 auto; border-radius:999px; cursor:pointer}

  .container{max-width:980px; margin:140px auto 40px; padding:0 16px} /* push below taller header */
  .muted{color:var(--muted); font-size:13px}

  /* ===== Keywords dropdown ===== */
  details.keywrap{margin:8px 0 18px; border:1px solid var(--ring); border-radius:12px; background:var(--card)}
  details.keywrap>summary{
    list-style:none; cursor:pointer; padding:10px 12px; display:flex; align-items:center; gap:8px; border-radius:12px
  }
  details[open].keywrap>summary{border-bottom:1px solid var(--ring)}
  .keywords{display:flex; flex-wrap:wrap; gap:8px; padding:12px}
  .pill{border:1px solid var(--ring); background:var(--pill); border-radius:999px; padding:6px 10px;
        font-size:12px; cursor:pointer; user-select:none}
  .pill.active{outline:2px solid #6366f1}

  /* ===== Cards & groups ===== */
  .group-date{margin:22px 0 12px; font-weight:800}
  .group-date.badge{display:inline-block; border-left:4px solid #6366f1; padding:4px 10px; border-radius:8px}
  .card{
    background:var(--card); border:1px solid var(--ring); border-radius:14px; padding:14px 16px; margin:10px 0;
    box-shadow:var(--shadow); transition:transform .12s ease, box-shadow .12s ease
  }
  .card:hover{transform:translateY(-1px)}
  .meta{display:flex; align-items:center; gap:10px; font-size:12px; color:var(--muted); margin-bottom:6px}
  .meta img{width:14px; height:14px; border-radius:3px}
  .title{font-size:18px; font-weight:800; line-height:1.35; margin:0; display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .click-here{
    font-size:14px; font-weight:600; margin-left:4px; color:var(--text);
    background:var(--ring); padding:3px 8px; border-radius:6px; text-decoration:none; transition:background .2s,color .2s
  }
  .click-here:hover{background:#6366f1; color:#fff}

  /* ============ Mobile polish ============ */
  @media (max-width: 768px) {
    .topbar { gap: 8px; padding: 8px 12px; }
    .brand { font-size: 18px; }
    .updated { font-size: 12px; }
    .toolbar { gap: 6px; }
    .input, .select, .toggle { padding: 10px 12px; border-radius: 12px; }
    .input { flex: 1 1 100%; min-width: 0; } /* full width search */
    .select { flex: 1 1 160px; }             /* wider tap target */
    .container { margin: 128px auto 40px; padding: 0 12px; }
    .card { padding: 12px; border-radius: 16px; }
    .title { font-size: 17px; gap: 8px; }
    .click-here { padding: 6px 10px; border-radius: 999px; } /* pill look */
    details.keywrap { margin: 6px 0 14px; }
    .keywords { gap: 6px; padding: 10px; }
    .pill { padding: 6px 10px; }
  }
  @media (max-width: 420px) {
    .updated { display: none; }               /* reduce header clutter */
    .select { flex: 1 1 100%; }               /* dropdown spans full width */
    .title { font-size: 16px; }
  }

  /* Optional compact mode: one-line clamp (toggle by adding .compact to <body>) */
  body.compact .title {
    display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical;
    overflow: hidden; white-space: normal;
  }

  /* Reduce motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .card, .topbar { transition: none; }
  }

  /* Sticky FAB (scroll-to-top) */
  .fab {
    position: fixed; right: 16px; bottom: 16px; z-index: 60;
    background: var(--ring); color: var(--text); border: 1px solid var(--ring);
    width: 46px; height: 46px; border-radius: 999px;
    display: grid; place-items: center; text-decoration: none;
    box-shadow: var(--shadow);
    opacity: 0; pointer-events: none; transform: translateY(8px);
    transition: opacity .15s ease, transform .15s ease;
  }
  .fab.show { opacity: .95; pointer-events: auto; transform: translateY(0); }
  .fab:hover { background: #6366f1; color: #fff; }

  /* Auto-hide header on scroll (mobile) */
  @media (max-width: 768px) {
    .topbar.hide { transform: translateY(-100%); transition: transform .2s ease; }
    .topbar { transition: transform .2s ease; }
  }
</style>
</head>
<body>
  <!-- ===== Header ===== -->
  <div class="topbar">
    <div class="brand">{{TITLE}}</div>
    <div class="updated">Updated: {{UPDATED}} â€¢ Items: {{COUNT}}</div>
    <div class="toolbar">
      <input id="q" class="input" placeholder="Search title/summaryâ€¦ (e.g., CVE-2025, Fortinet, RCE)">
      <select id="source" class="select"><option value="">All sources</option></select>
      <button id="theme" class="toggle" title="Toggle theme">ðŸŒ“ Theme</button>
    </div>
  </div>

  <!-- ===== Main ===== -->
  <div class="container">
    <details class="keywrap">
      <summary><span class="muted">Keywords</span></summary>
      <div id="kw" class="keywords">{{KEYWORDS}}</div>
    </details>

    <div id="list">{{ITEMS}}</div>
  </div>

  <!-- Scroll-to-top button -->
  <a href="#" id="fabTop" class="fab" aria-label="Scroll to top">â†‘</a>

<script>
/* ---------- Theme ---------- */
const root=document.documentElement;
const saved=localStorage.getItem("theme"); if(saved) root.setAttribute("data-theme",saved);
document.getElementById("theme").onclick=()=>{const nxt=root.getAttribute("data-theme")==="dark"?"light":"dark";
  root.setAttribute("data-theme",nxt); localStorage.setItem("theme",nxt);};

/* ---------- Enhance cards ---------- */
const list=document.getElementById('list');
const cards=[...list.querySelectorAll('.card')];
const sources=new Set();
cards.forEach(card=>{
  const link=card.dataset.link||'';
  try{
    const host=new URL(link).hostname;
    const img=document.createElement('img'); img.loading="lazy"; img.decoding="async";
    img.src=`https://www.google.com/s2/favicons?domain=${host}`;
    card.querySelector('.meta').prepend(img);
  }catch(e){}
  const s=card.dataset.source||''; if(s) sources.add(s);
});
const sel=document.getElementById('source'); [...sources].sort().forEach(s=>{
  const o=document.createElement('option'); o.value=s; o.textContent=s; sel.appendChild(o);
});

/* ---------- Date grouping (timezone-correct) ---------- */
function sameDay(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate();}
function dayLabel(d){
  const t=new Date(); const y=new Date(); y.setDate(t.getDate()-1);
  if (sameDay(d,t)) return "Today";
  if (sameDay(d,y)) return "Yesterday";
  return d.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});
}
(function group(){
  let last='';
  cards.forEach(card=>{
    const d=new Date(card.dataset.date||Date.now());
    const lbl=dayLabel(d);
    if(lbl!==last){
      const h=document.createElement('div'); h.className='group-date badge'; h.textContent=lbl;
      list.insertBefore(h,card); last=lbl;
    }
  });
})();

/* ---------- Filters (search/source/keyword) ---------- */
const q=document.getElementById('q'); const kw=document.getElementById('kw');
function apply(){
  const query=(q.value||'').trim().toLowerCase(); const src=sel.value;
  const tags=[...kw?.querySelectorAll('.pill.active')||[]].map(p=>p.dataset.k);
  cards.forEach(card=>{
    const text=(card.textContent||'').toLowerCase();
    const okQ=!query||text.includes(query);
    const okS=!src||(card.dataset.source===src);
    const okK=tags.length===0||tags.some(t=>text.includes(t));
    card.style.display=(okQ&&okS&&okK)?'':'none';
  });
  // hide empty group headers
  [...document.querySelectorAll('.group-date')].forEach(h=>{
    let n=h.nextElementSibling, any=false;
    while(n && !n.classList.contains('group-date')){
      if(n.style.display!=='none'){any=true;break;}
      n=n.nextElementSibling;
    }
    h.style.display=any?'':'none';
  });
}
q.addEventListener('input',apply); sel.addEventListener('change',apply);
kw?.querySelectorAll('.pill').forEach(p=>{const k=(p.textContent||'').trim().toLowerCase(); p.dataset.k=k;
  p.addEventListener('click',()=>{p.classList.toggle('active'); apply();});});
apply();

/* ===== Scroll-to-top FAB ===== */
const fab = document.getElementById('fabTop');
function onScrollFAB() {
  if (window.scrollY > 600) fab.classList.add('show'); else fab.classList.remove('show');
}
window.addEventListener('scroll', onScrollFAB, { passive: true });
fab.addEventListener('click', (e) => {
  e.preventDefault();
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

/* ===== Auto-hide header on scroll (mobile) ===== */
let lastY = 0;
const topbar = document.querySelector('.topbar');
function onScrollHeader() {
  const y = window.scrollY;
  const down = y > lastY;
  const small = window.matchMedia('(max-width: 768px)').matches;
  if (small && y > 80) {
    if (down) topbar.classList.add('hide'); else topbar.classList.remove('hide');
  } else {
    topbar.classList.remove('hide');
  }
  lastY = y;
}
window.addEventListener('scroll', onScrollHeader, { passive: true });

/* ===== Optional: Compact mode via localStorage =====
   Enable: localStorage.setItem('compact','1')
   Disable: localStorage.removeItem('compact')
*/
if (localStorage.getItem('compact') === '1') document.body.classList.add('compact');
</script>

<!-- Card markup expected from the builder:
<div class="card" data-source="BleepingComputer" data-date="2025-08-30T21:52:51Z" data-link="https://...">
  <div class="meta">BleepingComputer â€” 30/08/2025, 21:52:51</div>
  <h2 class="title">Headline text <a href="https://..." class="click-here" target="_blank" rel="noopener">Click here</a></h2>
</div>
-->
</body>
</html>
